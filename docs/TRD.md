3. TRD.md (Technical Requirements Document)
   code
   Markdown

# ⚙️ TRD: Technical Architecture

## 1. System Architecture

- **Frontend:** Next.js 15 (App Router)
- **Backend/DB:** Supabase (PostgreSQL + Edge Functions)
- **Auth:** Clerk
- **AI:** Google Gemini 1.5 Flash (Logic & Writing)
- **Automation:** n8n (Self-hosted or Cloud)
- **Form Engine:** Python FastAPI (Microservice for HWP generation)

## 2. Database Schema (V3.0 Final)

```sql
-- 1. Users (복지 자격 상세)
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  clerk_user_id TEXT UNIQUE NOT NULL,
  birth_year INTEGER,
  occupation TEXT, -- worker, student, none
  disability_info JSONB, -- { type: 'visual', level: 'severe', registered: true }
  is_veteran BOOLEAN DEFAULT FALSE, -- 보훈
  ltc_grade INTEGER, -- 장기요양등급 (null이면 없음)
  created_at TIMESTAMPTZ DEFAULT now()
);

-- 2. Welfare_Programs (9개 사업 정적 데이터)
CREATE TABLE welfare_programs (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  ministry TEXT NOT NULL, -- 'MOHW', 'MOEL', 'MSIT', 'MOE', 'MPVA'
  program_name TEXT NOT NULL,
  target_logic JSONB NOT NULL, -- 자격 판별 로직 (JSON Rule)
  subsidy_limit INTEGER, -- 지원 한도
  form_template_path TEXT -- HWP/PDF 템플릿 경로
);

-- 3. Products (제품)
CREATE TABLE products (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name TEXT NOT NULL,
  domain TEXT, -- adl, mobility, sensory
  market_price INTEGER,
  purchase_link TEXT,
  specs JSONB, -- 스펙
  tags TEXT[], -- AI 태그
  is_active BOOLEAN DEFAULT TRUE -- n8n 수집 후 검수용
);

-- 4. Product_Welfare_Relations (N:M 매핑)
-- 하나의 제품이 여러 사업의 지원 대상일 수 있음
CREATE TABLE product_welfare_relations (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  product_id BIGINT REFERENCES products(id),
  program_id BIGINT REFERENCES welfare_programs(id),
  official_code TEXT, -- 고시 코드
  price_limit INTEGER -- 해당 사업에서의 인정 가격
);

-- 5. Applications (신청서 생성 로그)
CREATE TABLE applications (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id),
  program_id BIGINT REFERENCES welfare_programs(id),
  generated_content JSONB, -- AI가 쓴 내용
  file_url TEXT, -- 생성된 파일 다운로드 링크
  created_at TIMESTAMPTZ DEFAULT now()
);
```
