3. TRD (Technical Requirements Document)
3.1 데이터베이스 스키마 (Supabase)
범용성을 위해 category 컬럼을 세분화하고, tags를 활용합니다.

-- 1. Users
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  clerk_user_id TEXT UNIQUE NOT NULL,
  nickname TEXT,
  created_at TIMESTAMPTZ DEFAULT now()
);

-- 2. Products
CREATE TABLE products (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name TEXT NOT NULL,
  
  -- 대분류: mobility, adl_eating, adl_bathing, sensory_vision, communication, computer_access 등
  domain TEXT NOT NULL, 
  
  -- 상세 분류: manual_wheelchair, weighted_spoon, shower_chair, magnifier, aac_device
  category TEXT NOT NULL, 
  
  price INTEGER NOT NULL,
  image_url TEXT,
  purchase_link TEXT NOT NULL,
  
  -- 기능 태그: ['손떨림방지', '고대비', 'TTS지원', '헤드트래킹', '한손조작']
  tags TEXT[], 
  
  description TEXT -- 전문가 리뷰
);

-- 3. Assessment Logs
CREATE TABLE assessment_logs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id),
  
  -- 선택된 영역 및 상세 답변
  -- ex: { "domains": ["adl_eating", "mobility"], "symptom": "tremor", "goal": "eat_alone" }
  input_data JSONB, 
  
  gemini_analysis JSONB, 
  created_at TIMESTAMPTZ DEFAULT now()
);

-- 4. Recommendations
CREATE TABLE recommendations (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  log_id UUID REFERENCES assessment_logs(id),
  product_id BIGINT REFERENCES products(id),
  is_clicked BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMPTZ DEFAULT now()
);

3.2 AI 프롬프트 설계 (Gemini System Instruction)
이 부분이 프로젝트의 핵심 두뇌입니다. 전문가의 분류 체계를 AI에게 학습시킵니다.
System Instruction:
당신은 16년차 보조공학 전문가(ATP)입니다. 사용자의 신체 기능과 활동 영역을 분석하여 최적의 보조기기를 매칭합니다.
[분석 프레임워크]
Body Functions: 시각, 청각, 언어, 신경근육골격(근력, 긴장도, 떨림 등).
Activity Areas:
ADL: 식사(Eating), 목욕(Bathing), 세면(Grooming), 착탈의(Dressing), 화장실(Toileting).
Mobility: 이동, 이승, 차량 탑승.
Communication/Tech: 의사소통(AAC), 컴퓨터 접근(Computer Access).
Positioning: 자세 유지(Seating).
[작업 지시]
사용자의 입력(불편함, 목표)을 바탕으로:
가장 시급한 **활동 영역(Domain)**과 제품 카테고리를 식별하세요.
검색에 필요한 **기능 태그(Tags)**를 3~5개 추출하세요.
추천 사유를 전문가스럽지만 알기 쉽게 3줄로 요약하세요.
[Output Format] JSON only.
{ "summary": "...", "target_domain": "adl_eating", "recommended_category": "weighted_spoon", "search_tags": ["손떨림방지", "무거운손잡이"] }